<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8"/> 
        <script src="dist/interop.js"></script>
        <title>Javscript Interop Demo</title>
    </head>
    <body style="margin: 8px;">
        <div style="position: relative">
            <img src="https://unsplash.it/900/600?image=1067" width="900" height="600" style="max-width: 100%; height: auto;" id="image">
            <div id="main"></div>
            <!--<object style="display: block; pointer-events: none; position: absolute; left: 0; top: 0; width: 100%; height: 100%; background-color: transparent; z-index: -100;" data="about:blank" id="resize-detector"></object>-->
        </div>
        <div id="coordinates">
            (<span id="top-left-x">0</span>|<span id="top-left-y">0</span>),
            (<span id="bottom-right-x">100</span>|<span id="bottom-right-y">100</span>)
        </div>
        <form id="aspect-ratio-form">
            Aspect Ratio
            <label>
                Width
                <input type="number" step="1" min="1" id="aspect-ratio-width-input"/>
            </label>
            <label>
                Height
                <input type="number" step="1" min="1" id="aspect-ratio-height-input"/>
            </label>
            <button>Set</button>
        <script>
var image = document.getElementById('image');
var node = document.getElementById('main');
var app = Elm.Interop.embed(node, {
    image: {width: 900, height: 600},
    cropAreaWidth: getImageWidth(),
    offset: {x: 8, y: 8},
    selection: {topLeft: {x: 0, y: 0}, bottomRight: {x: 100, y: 100}},
    aspectRatio: null
});
var
    coordinatesDiv = document.getElementById('coordinates'),
    topLeftX = document.getElementById('top-left-x'),
    topLeftY = document.getElementById('top-left-y'),
    bottomRightX = document.getElementById('bottom-right-x'),
    bottomRightY = document.getElementById('bottom-right-y');
app.ports.selectionChanged.subscribe(function (selection) {
    if (selection !== null) {
        topLeftX.innerHTML = selection.topLeft.x;
        topLeftY.innerHTML = selection.topLeft.y;
        bottomRightX.innerHTML = selection.bottomRight.x;
        bottomRightY.innerHTML = selection.bottomRight.y;
        coordinatesDiv.style.display = 'block';
    } else {
        coordinatesDiv.style.display = 'none';
    }
});
//var resizeDetector = document.getElementById('resize-detector');
//resizeDetector.addEventListener('load', function () {
//    resizeDetector
//        .contentDocument
//        .defaultView
//        .addEventListener('resize', function () {
//            app.ports.viewportChanged.send(getImageWidth());
//        });
//});
window.addEventListener('resize', function () {
    app.ports.viewportChanged.send(getImageWidth());
});
function getImageWidth() {
    return +getComputedStyle(image).width.replace('px', '');
}
document
    .getElementById('aspect-ratio-form')
    .addEventListener('submit', function (event) {
        event.preventDefault();
        var aspectRatio = {
            width: +document.getElementById('aspect-ratio-width-input').value,
            height: +document.getElementById('aspect-ratio-height-input').value,
        };
        app.ports.changeAspectRatio.send(aspectRatio);
    });
        </script>
    </body>
</html>
